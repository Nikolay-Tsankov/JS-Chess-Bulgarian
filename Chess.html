<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
		<script>
        document.addEventListener('DOMContentLoaded', function(event){
			let WhoseTurnIsIt = 1;				//1 - бял, 0 - черен
			let AmInCheck = 0;	
			let CurrentlyPromoting = 0;				
			let MyCoordinates = ['', '', ''];
			let TakenFigures = [];
			let CurrentDanger = [];
			let moves = [];
			let OldCoordinates;
			let Positions = [];
			let WTimer = 6000;
			let BTimer = 6000;
			let board = [
						  ['BlackRookL', 'BlackKnight', 'BlackBishop', 'BlackQueen', 'BlackCar', 'BlackBishop', 'BlackKnight', 'BlackRookR'],
						  ['BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn'],
						  ['', '', '', '', '', '', '', ''],
						  ['', '', '', '', '', '', '', ''],
						  ['', '', '', '', '', '', '', ''],
						  ['', '', '', '', '', '', '', ''],
						  ['WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn'],
						  ['WhiteRookL', 'WhiteKnight', 'WhiteBishop', 'WhiteQueen', 'WhiteCar', 'WhiteBishop', 'WhiteKnight', 'WhiteRookR']
						];
			let Kvadrati = document.querySelectorAll('.board-square');

			let EnPassant = 0;
			let FiftyMoveRuleCounter = 0;

			let BlackCastleLong = 1;
			let WhiteCastleLong = 1;
			let BlackCastleShort = 1;
			let WhiteCastleShort = 1;


			let PieceSet = 'Set-1';
			let ColorPalate = 1;


			const VisualiseSquares = () => {
				for(let i = 0; i < 8; i++){
					for(let j = 0; j < 8; j++){
						if(ColorPalate ==1){
							if((parseInt(i)+parseInt(j))%2==0){
								document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.background = '#F0D9B5';
							} else{
								document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.background = '#B58863';								
							}
						}
						else if(ColorPalate ==2){
							if((parseInt(i)+parseInt(j))%2==0){
								document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.background = '#DCDCDC';
							} else{
								document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.background = '#ABABAB';							
							}							
						}
						else if(ColorPalate ==3){
							if((parseInt(i)+parseInt(j))%2==0){
								document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.background = '#F0D8BF';
							} else{
								document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.background = '#BA5546';							
							}							
						}
					}
				}
			}

			const VisualiseBoard = () => {
				for(let i = 0; i < 8; i++){
					for(let j = 0; j < 8; j++){
						if(board[i][j] != ''){
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.backgroundImage = "url(" + PieceSet + '/' + board[i][j].substring(0, 6) + '.png)';
							}else{
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.style.backgroundImage = "url()";							
						}
					} 
				}
			}

			VisualiseSquares();
			VisualiseBoard();

			Kvadrati.forEach(item => {
				item.addEventListener('click', (e) => {
					if(!CurrentlyPromoting){
						if(!AmInCheck && e.target.classList.contains('GREENSQUARE')){
							//Натиснат е зелен квадрат, местим фигура, край на ход
							RemGreenSquares();
							EndOfTurn(MyCoordinates, e.target);
						}

						else if(AmInCheck && e.target.classList.contains('GREENSQUARE')){
							//Натиснат е зелен квадрат, местим фигура, край на ход
							//Царят е в шах
							RemGreenSquares();

							let MovingFigure = MyCoordinates[2];
							if(CurrentDanger == 'двойна заплаха' && MovingFigure.split('')[5] != 'C'){
								//Ако сме в двоен шах не можем да блокираме, трябва да местим царя
							}
							else if (MovingFigure.split('')[5] != 'C'){
								if(!document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(GetCoordinates(e.target)[0])+1) + ') td:nth-child(' + (parseInt(GetCoordinates(e.target)[1])+1) + ')').firstElementChild.classList.contains('PURPLESQUARE')){
									//Опитваме се да местим фигура, така че не блокираме шаха
								}
								else{
									//Местим фигура и блокираме шаха
									EndOfTurn(MyCoordinates, e.target);
								}
							}
							else if (MovingFigure.split('')[5] == 'C'){
								//Местим царя
								EndOfTurn(MyCoordinates, e.target);
							}
						}

						else{
							RemGreenSquares();
							MyCoordinates = GetCoordinates(e.target);

							if (MyCoordinates[2] == ''){
								//Натиснат е празен квадрат
							}
							else if (WhoseTurnIsIt && MyCoordinates[2].split('')[0]=='B'){
								//Натиснат е недостъпен квадрат
							}
							else if (!WhoseTurnIsIt && MyCoordinates[2].split('')[0]=='W'){
								//Натиснат е недостъпен квадрат
							}

							else if (WhoseTurnIsIt && MyCoordinates[2].split('')[0]=='W'){	
								//Достъпен квадрат - своя фигура	
								switch(MyCoordinates[2].split('')[5]){
									case 'P':
										WhitePawnMovement(MyCoordinates);
										break;
									case 'B':
										BishopMovement(MyCoordinates);
										break;
									case 'R':
										RookMovement(MyCoordinates);
										break;
									case 'K':
										KnightMovement(MyCoordinates);
										break;
									case 'C':
										KingMovement(MyCoordinates);
										break;
									case 'Q':
										BishopMovement(MyCoordinates);
										RookMovement(MyCoordinates);
										break;
								}
							}
							else if (!WhoseTurnIsIt && MyCoordinates[2].split('')[0]=='B'){
								//Достъпен квадрат - своя фигура	
								switch(MyCoordinates[2].split('')[5]){
									case 'P':
										BlackPawnMovement(MyCoordinates);
										break;
									case 'B':
										BishopMovement(MyCoordinates);
										break;
									case 'R':
										RookMovement(MyCoordinates);
										break;
									case 'K':
										KnightMovement(MyCoordinates);
										break;
									case 'C':
										KingMovement(MyCoordinates);
										break;
									case 'Q':
										BishopMovement(MyCoordinates);
										RookMovement(MyCoordinates);
										break;
								}
							}
						}
						ColorisePurpleAndGreen();
					}
				});
			});

			let BoardRadioButtons = document.querySelectorAll('.board-radio');
			BoardRadioButtons.forEach(item => {
				item.addEventListener('change', (e) => {
					if(item.classList.contains('board-brown')){
						ColorPalate = 1;
					}else if (item.classList.contains('board-grey')){
						ColorPalate = 2;
					}else if (item.classList.contains('board-red')){
						ColorPalate = 3;
					}

					VisualiseSquares();
					VisualiseBoard();
					ColorisePurpleAndGreen();
				});
			});

			let PieceButtons = document.querySelectorAll('.pieces-radio');
			PieceButtons.forEach(item => {
				item.addEventListener('change', (e) => {
					if(item.classList.contains('piece-type-1')){
						PieceSet = 'Set-1';
					}
					else if(item.classList.contains('piece-type-2')){
						PieceSet = 'Set-2';
					}					
					else if(item.classList.contains('piece-type-3')){
						PieceSet = 'Set-3';
					}
					VisualiseSquares();
					VisualiseBoard();	
					ColorisePurpleAndGreen();
				});
			});


			let ResetButton = document.querySelector('.reset');
			ResetButton.addEventListener('click', (e) => {
				WhoseTurnIsIt = 1;				//1 - бял, 0 - черен
				AmInCheck = 0;					
				MyCoordinates = ['', '', ''];
				TakenFigures = [];
				CurrentDanger = [];
				Kvadrati = document.querySelectorAll('.board-square');
				moves = [];
				WTimer = 6000;
				BTimer = 6000;
				board = [
							  ['BlackRookL', 'BlackKnight', 'BlackBishop', 'BlackQueen', 'BlackCar', 'BlackBishop', 'BlackKnight', 'BlackRookR'],
							  ['BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn', 'BlackPawn'],
							  ['', '', '', '', '', '', '', ''],
							  ['', '', '', '', '', '', '', ''],
							  ['', '', '', '', '', '', '', ''],
							  ['', '', '', '', '', '', '', ''],
							  ['WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn', 'WhitePawn'],
							  ['WhiteRookL', 'WhiteKnight', 'WhiteBishop', 'WhiteQueen', 'WhiteCar', 'WhiteBishop', 'WhiteKnight', 'WhiteRookR']
							];

				EnPassant = 0;
				FiftyMoveRuleCounter = 0;

				BlackCastleLong = 1;
				WhiteCastleLong = 1;
				BlackCastleShort = 1;
				WhiteCastleShort = 1;
				VisualiseSquares();
				VisualiseBoard();
				document.querySelector('#OpeningNameDiv').innerText = 'Начална позиция';


				let WhiteBar = document.querySelector('.white-taken-figures');
				let BlackBar = document.querySelector('.black-taken-figures');
				[...WhiteBar.children].forEach(item => {
					item.remove();
				});
				[...BlackBar.children].forEach(item => {
					item.remove();
				});

				let MoveListDiv = document.querySelector('.movelist');
				[...MoveListDiv.children].forEach(item => {
					item.remove();
				});
			});



			let TimerButtons = document.querySelectorAll('.timer-button');
			TimerButtons.forEach(item => {
				item.addEventListener('click', (e) => {
					if(item.dataset.color == 'white'){
						if(item.dataset.time.substring(0,1) == '='){
							WTimer = parseInt(item.dataset.time.substring(1,item.dataset.time.length));
						}else if(item.dataset.time.substring(0,1) == '+'){
							WTimer += parseInt(item.dataset.time.substring(1,item.dataset.time.length));
						}				
					}
					else if(item.dataset.color == 'black'){
						if(item.dataset.time.substring(0,1) == '='){
							BTimer = parseInt(item.dataset.time.substring(1,item.dataset.time.length));
						}else if(item.dataset.time.substring(0,1) == '+'){
							BTimer += parseInt(item.dataset.time.substring(1,item.dataset.time.length));
						}				
					}					
				});
			});

			let TimerCheckbox = document.querySelector('#TimerCheckbox');
			let intervalId;
			let WhiteTimer = document.querySelector('.white-timer');
			let BlackTimer = document.querySelector('.black-timer');

			TimerCheckbox.addEventListener('change', (e) => {
			  if (TimerCheckbox.checked) {
			    TimerButtons.forEach(item => {
			      item.style.display = 'block';
			    });
			    intervalId = setInterval(function() {
			      if (WhoseTurnIsIt) {
			        WTimer -= 1;
			      } else {
			        BTimer -= 1;
			      }
			      if (WTimer == 0) {
			        // Заключваме дъската
			        alert('Времето на играча с белите фигури свърши');
			        AmInCheck = 1;
				    clearInterval(intervalId);
			        Kvadrati.forEach(item1 => {
			          if (item.classList.contains('PURPLESQUARE')) item.classList.remove('PURPLESQUARE');
			        });
			      } else if (BTimer == 0) {
			        // Заключваме дъската
			        alert('Времето на играча с черните фигури свърши');
			        AmInCheck = 1;
				    clearInterval(intervalId);
			        Kvadrati.forEach(item1 => {
			          if (item.classList.contains('PURPLESQUARE')) item.classList.remove('PURPLESQUARE');
			        });
			      }
			      WhiteTimer.innerText = Math.floor(parseInt(WTimer) / 600) + ':' + (parseInt(WTimer) % 600)/10;
			      BlackTimer.innerText = Math.floor(parseInt(BTimer) / 600) + ':' + (parseInt(BTimer) % 600)/10;

			    }, 100);
			  } else {
			    clearInterval(intervalId);
			    TimerButtons.forEach(item => {
			      item.style.display = 'none';
			    });
			  }
			});



			let ColorisePurpleAndGreen = () => {
				//Оцветяваме зелените и лилавите квадрати
				let WasPurple = 0;
				Kvadrati.forEach(item => {
					if(!item.classList.contains('GREENSQUARE')){
						//Ако не е зелен квадрат, но е със снимката за зелен квадрат, трябва да я махнем
						if(item.style.backgroundImage.substring(0,19) == 'url("Purple.png"), '){
							//Първо махаме всички лилавия от началото на фона
							item.style.backgroundImage = item.style.backgroundImage.substring(19, item.style.backgroundImage.length);
							WasPurple = 1;
						}

						if( item.style.backgroundImage.substring(0,18) == 'url("Green.png"), '){
							//Махаме зеления фон
							item.style.backgroundImage = item.style.backgroundImage.substring(18, item.style.backgroundImage.length);
						}

						if(WasPurple){
							//Връщами лилавия фон									
							item.style.backgroundImage = 'url("Purple.png"), ' + item.style.backgroundImage;
							WasPurple = 0;
						}
					}
					else{

						if(item.style.backgroundImage.substring(0,19) == 'url("Purple.png"), '){
							//Първо махаме лилавия от началото на фона
							item.style.backgroundImage = item.style.backgroundImage.substring(19, item.style.backgroundImage.length);
							WasPurple = 1;
						}

						if( item.style.backgroundImage.substring(0,18) != 'url("Green.png"), '){
							//Добавяме зелен фон
							item.style.backgroundImage = 'url("Green.png"), ' + item.style.backgroundImage;
						}

						if(WasPurple){
							//Връщами лилавия фон									
							item.style.backgroundImage = 'url("Purple.png"), ' + item.style.backgroundImage;
							WasPurple = 0;
						}								
					}
					if(item.classList.contains('PURPLESQUARE')){
						if(item.style.backgroundImage.substring(0,19) != 'url("Purple.png"), '){
							item.style.backgroundImage = 'url("Purple.png"), ' + item.style.backgroundImage;
						}
					}
				});
			}


			const GenerateFEN = () => {
				let FEN = '';
				let FENrow = '';
				for(let i = 0; i < 8; i++){
					let EmptySquareCounter = 0; 
					for(let j = 0; j < 8; j++){
						switch(board[i][j]){
							case '':
								EmptySquareCounter += 1;
								break;
							case 'BlackRookR':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'r';
								break;
							case 'BlackRookL':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'r';
								break;
							case 'WhiteRookR':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'R';
								break;
							case 'WhiteRookL':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'R';
								break;
							case 'BlackKnight':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'n';
								break;
							case 'WhiteKnight':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'N';
								break;
							case 'BlackBishop':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'b';
								break;
							case 'WhiteBishop':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'B';
								break;
							case 'BlackCar':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'k';
								break;
							case 'WhiteCar':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'K';
								break;
							case 'BlackQueen':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'q';
								break;
							case 'WhiteQueen':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'Q';
								break;
							case 'BlackPawn':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'p';
								break;
							case 'WhitePawn':
								if(EmptySquareCounter != 0){
									FENrow += EmptySquareCounter;
									EmptySquareCounter = 0;
								}
								FENrow += 'P';
								break;
						}
						if(board[i][j] == '' && j == 7){
							FENrow += EmptySquareCounter;
						}						
					}
					if(i != 7){
						FENrow += '/';
					}
					FEN += FENrow;
					FENrow = '';
				}
				if(WhoseTurnIsIt){
					FEN += ' w ';
				}else{
					FEN += ' b ';
				}
				let FENCastle = '';
				if(WhiteCastleShort) FENCastle += 'K';
				if(WhiteCastleLong) FENCastle += 'Q';
				if(BlackCastleShort) FENCastle += 'k';
				if(BlackCastleLong) FENCastle += 'q';
				if(FENCastle == '') FENCastle = '-';

				FEN += FENCastle;

				return FEN;
			}


			const GetOpeningName = () => {
				let FEN = GenerateFEN();
				fetch('https://raw.githubusercontent.com/hayatbiralem/eco.json/master/eco.json')
	                 .then(r => r.json())
	                 .then(data => {
	                 	for(let i = 0; i<data.length; i++){
	                 		if(data[i].fen == FEN){
	                 			document.querySelector('#OpeningNameDiv').innerText = data[i].name;
	                 			break;
	                 		}
	                 	}	
	               	});
			}

			function indexOf2dArray(array2d, itemtofind) {
			    index = [].concat.apply([], ([].concat.apply([], array2d))).indexOf(itemtofind);
			    if (index === -1) { return false; }
			    numColumns = array2d[0].length;
			    row = parseInt(index / numColumns)
			    col = index % numColumns;
			    return [row, col]; 
			}

			const MakeSquareGreen = (red, kol) => {
				document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(red)+1) + ') td:nth-child(' + (parseInt(kol)+1) + ')').firstElementChild.classList.add('GREENSQUARE');			
			}

			const GetCoordinates = (target) => {
				//Таргет-а тбярва да е бутона, който се натиска, а не клетката в която бутона се намира
				let ColIndex =Array.prototype.indexOf.call(target.parentNode.parentNode.children, target.parentNode);
				let RowIndex =Array.prototype.indexOf.call(target.parentNode.parentNode.parentNode.children, target.parentNode.parentNode);
				let Coordinates = [RowIndex, ColIndex, board[RowIndex][ColIndex] ];
				return Coordinates;
			}

			const RemGreenSquares = () => {
				Kvadrati.forEach(item => {
					if (item.classList.contains('GREENSQUARE')){
						item.classList.remove('GREENSQUARE');
					}
				});
			}

			const EndOfTurn = (MyCoordinates1, BUTON) => {
				//КРАЙ НА ХОД - провери за promotion, en passant, поискай evaluation и име на началото, ресетни дъската, добови хода в списъка с ходове
				let move = '';
				let DidITakeAFigure = 0;

				//Местим фигурата
				let MovingFigure = MyCoordinates1[2];
				board[MyCoordinates1[0]][MyCoordinates1[1]]= '';
				OldCoordinates = [MyCoordinates1[0], MyCoordinates1[1]];
				MyCoordinates = GetCoordinates(BUTON);
				if (board[MyCoordinates[0]][MyCoordinates[1]] != ''){
					DidITakeAFigure = 1;
					TakenFigures.push(board[MyCoordinates[0]][MyCoordinates[1]]);
				}
				board[MyCoordinates[0]][MyCoordinates[1]] = MovingFigure;
				

				//Ако изместената фигура е открила шах я връщаме
				if(WhoseTurnIsIt && CheckForDanger(indexOf2dArray(board, 'WhiteCar'), 'B') != 'safe'){
					board[OldCoordinates[0]][OldCoordinates[1]] = MovingFigure;
					if(DidITakeAFigure){
						board[MyCoordinates[0]][MyCoordinates[1]] = TakenFigures[TakenFigures.length];						
						TakenFigures = TakenFigures.pop();
					}
					else{
						board[MyCoordinates[0]][MyCoordinates[1]] = '';												
					}
					DidITakeAFigure = 0;
				}
				else if(!WhoseTurnIsIt && CheckForDanger(indexOf2dArray(board, 'BlackCar'), 'W') != 'safe') {
					board[OldCoordinates[0]][OldCoordinates[1]] = MovingFigure;
					if(DidITakeAFigure){
						board[MyCoordinates[0]][MyCoordinates[1]] = TakenFigures[TakenFigures.length];						
						TakenFigures = TakenFigures.pop();
					}
					else{
						board[MyCoordinates[0]][MyCoordinates[1]] = '';												
					}
					DidITakeAFigure = 0;
				}
				else{
					if(MovingFigure.split('')[5]=='P' &&  MovingFigure.split('')[0] == 'W' && WhoseTurnIsIt && MyCoordinates[0]=='0'){
						FiftyMoveRuleCounter = 0;
						EnPassant = [];
						CurrentlyPromoting = 1;
						//Promotion
						document.querySelector('#Tabl1').style.filter = 'brightness(10%)';
						
						Promotion(DidITakeAFigure);
					}
					else if (!WhoseTurnIsIt && MovingFigure.split('')[5]=='P' &&  MovingFigure.split('')[0] == 'B' &&  MyCoordinates[0]=='7'){
						FiftyMoveRuleCounter = 0;
						EnPassant = [];
						CurrentlyPromoting = 1;
						//Promotion
						document.querySelector('#Tabl1').style.filter = 'brightness(10%)';
						
						Promotion(DidITakeAFigure);
					}
					else{
						//Ако местим пешка
						if(MovingFigure.split('')[5]=='P'){
							FiftyMoveRuleCounter = 0;
							if(EnPassant[0] == MyCoordinates[0] && EnPassant[1] == MyCoordinates[1]){
								if(WhoseTurnIsIt){
									TakenFigures.push(board[parseInt(MyCoordinates[0])+1][MyCoordinates[1]]);
									board[parseInt(MyCoordinates[0])+1][MyCoordinates[1]] = '';
									DidITakeAFigure = 1;

								}else{
									TakenFigures.push(board[parseInt(MyCoordinates[0])-1][MyCoordinates[1]]);
									board[parseInt(MyCoordinates[0])-1][MyCoordinates[1]] = '';
									DidITakeAFigure = 1;
								}
							}
						}
						else{
							FiftyMoveRuleCounter += 1;
						}

						//Ан пасан
						if(MovingFigure.split('')[5]=='P' &&  MovingFigure.split('')[0] == 'W' && WhoseTurnIsIt && MyCoordinates[0]=='4' && OldCoordinates[0] == '6'){
							EnPassant = [parseInt(MyCoordinates[0])+1, MyCoordinates[1]];
						}
						else if(MovingFigure.split('')[5]=='P' &&  MovingFigure.split('')[0] == 'B' && !WhoseTurnIsIt && MyCoordinates[0]=='3' && OldCoordinates[0] == '1'){
							EnPassant = [parseInt(MyCoordinates[0])-1, MyCoordinates[1]];
						} else{
							EnPassant = [];
						}


						//Рокади
						if(WhoseTurnIsIt && WhiteCastleLong && MyCoordinates[1] == '2' && MovingFigure.split('')[5]=='C'){
							board[7][0]='';
							board[7][3]='WhiteRookL';
							WhiteCastleLong = 0;							
							WhiteCastleShort = 0;							
							move = '0-0-0';						
						}
						if(WhoseTurnIsIt && WhiteCastleShort && MyCoordinates[1] == '6' && MovingFigure.split('')[5]=='C'){
							board[7][7]='';
							board[7][5]='WhiteRookR';
							WhiteCastleLong = 0;							
							WhiteCastleShort = 0;							
							move = '0-0';						
						}
						if(!WhoseTurnIsIt && BlackCastleLong && MyCoordinates[1] == '2' && MovingFigure.split('')[5]=='C'){
							board[0][0]='';
							board[0][3]='BlackRookL';
							BlackCastleLong = 0;							
							BlackCastleShort = 0;	
							move = '0-0-0';						
						}
						if(!WhoseTurnIsIt && BlackCastleShort && MyCoordinates[1] == '6' && MovingFigure.split('')[5]=='C'){
							board[0][7]='';
							board[0][5]='BlackRookR';
							BlackCastleLong = 0;							
							BlackCastleShort = 0;							
							move = '0-0';						
						}
						if(MovingFigure.split('')[0]=='B' && MovingFigure.split('')[5]=='R' && MovingFigure.split('')[9]=='L'){
							BlackCastleLong = 0;
						}
						if(MovingFigure.split('')[0]=='B' && MovingFigure.split('')[5]=='R' && MovingFigure.split('')[9]=='R'){
							BlackCastleShort = 0;
						}
						if(MovingFigure.split('')[0]=='W' && MovingFigure.split('')[5]=='R' && MovingFigure.split('')[9]=='L'){
							WhiteCastleLong = 0;
						}						
						if(MovingFigure.split('')[0]=='W' && MovingFigure.split('')[5]=='R' && MovingFigure.split('')[9]=='R'){
							WhiteCastleShort = 0;
						}
						if(MovingFigure.split('')[0]=='W' && MovingFigure.split('')[5]=='C'){
							WhiteCastleLong = 0;							
							WhiteCastleShort = 0;
						}											
						if(MovingFigure.split('')[0]=='B' && MovingFigure.split('')[5]=='C'){
							BlackCastleLong = 0;							
							BlackCastleShort = 0;
						}
					}	
					let CurrentCoordinates = [MyCoordinates[0], MyCoordinates[1]]
					if(!CurrentlyPromoting){

						WhoseTurnIsIt = !WhoseTurnIsIt;
						// В шах ли сме?
						if(WhoseTurnIsIt){
							if(CheckForDanger(indexOf2dArray(board, 'WhiteCar'), 'B') != 'safe'){
								AmInCheck = 1;
								CurrentDanger = CheckForDanger(indexOf2dArray(board, 'WhiteCar'), 'B');
								console.log('ШАХ!');
								if(CurrentDanger != 'двойна заплаха'){
									CurrentDanger.forEach(item => {
										document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(item[0])+1) + ') td:nth-child(' + (parseInt(item[1])+1) + ')').firstElementChild.classList.add('PURPLESQUARE');
									});									
								}
							}
							else{
								AmInCheck = 0;
								CurrentDanger = [];
								Kvadrati.forEach(item => {
									if(item.classList.contains('PURPLESQUARE')){
										item.classList.remove('PURPLESQUARE');
									}
								});
							}
						}else {
							if(CheckForDanger(indexOf2dArray(board, 'BlackCar'), 'W') != 'safe'){
								AmInCheck = 1;
								CurrentDanger = CheckForDanger(indexOf2dArray(board, 'BlackCar'), 'W');
								console.log('ШАХ!');
								if(CurrentDanger != 'двойна заплаха'){
									CurrentDanger.forEach(item => {
										document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(item[0])+1) + ') td:nth-child(' + (parseInt(item[1])+1) + ')').firstElementChild.classList.add('PURPLESQUARE');
									});									
								}
							}
							else{
								AmInCheck = 0;
								CurrentDanger = [];
								Kvadrati.forEach(item => {
									if(item.classList.contains('PURPLESQUARE')){
										item.classList.remove('PURPLESQUARE');
									}
								});
							}
						}

						if(move == ''){
							//Ако "ходът" е празен - не е направена рокада
							let column;
							let column1;
							switch(OldCoordinates[1]){
									case 0:
										column1 = 'a';
										break;
									case 1:
										column1 = 'b';
										break;
									case 2:
										column1 = 'c';
										break;
									case 3:
										column1 = 'd';
										break;
									case 4:
										column1 = 'e';
										break;
									case 5:
										column1 = 'f';
										break;
									case 6:
										column1 = 'g';
										break;
									case 7:
										column1 = 'h';
										break;
								}

							switch(CurrentCoordinates[1]){
									case 0:
										column = 'a';
										break;
									case 1:
										column = 'b';
										break;
									case 2:
										column = 'c';
										break;
									case 3:
										column = 'd';
										break;
									case 4:
										column = 'e';
										break;
									case 5:
										column = 'f';
										break;
									case 6:
										column = 'g';
										break;
									case 7:
										column = 'h';
										break;
								}
							//Създаваме името на хода
							if(MovingFigure.split('')[5] == 'P'){}
							else if (MovingFigure.split('')[5] == 'C') move += 'K';
							else if (MovingFigure.split('')[5] == 'K') move += 'N';
							else move += MovingFigure.split('')[5];
							if(DidITakeAFigure){
								//Ако пешка е взела, то се отбелязва реда и
								if(MovingFigure.split('')[5] == 'P') move += column1;
								
								move += 'x';
								//Правилото с 50те хода се нулира при взета фигура	
								FiftyMoveRuleCounter = 0;
							} 
							move += column;
							move += (7 - parseInt(CurrentCoordinates[0]) + 1);
							if(AmInCheck){
								if(CheckForMate()) move += '#';
								else move += '+';
							}
						}

						moves.push(move);

						console.log(board);
						LoadMoves();
						VisualiseBoard();
						LoadTakenFigures();
						GetOpeningName();
						if(FiftyMoveRuleCounter == 100){
							//Заключваме дъската
							AmInCheck = 1;
							Kvadrati.forEach(item1 => {
								if(item.classList.contains('PURPLESQUARE')) item.classList.remove('PURPLESQUARE');
							});
							alert('Не сте местили пешка от 50 хода - равенство');
						}
						if(AmInCheck){
							if(CheckForMate()){
								let s;
								if(WhoseTurnIsIt){
									s = 'Белият'
								}
								else{
									s = 'Черният';
								}
								Kvadrati.forEach(item => {
										if(item.classList.contains('PURPLESQUARE')){
											item.classList.remove('PURPLESQUARE');
										}
									});
								alert(s + ' цар е в мат!');
							}
						}
						else{
							if(CheckForStalemate()){
								Kvadrati.forEach(item => {
									if(item.classList.contains('PURPLESQUARE')){
										item.classList.remove('PURPLESQUARE');
									}
								});						
								alert('Равенство - царят е в пат!');							
							}
						}
						Positions.push(GenerateFEN());
						console.log(Positions);
						let ThreefoldRpeptitionCounter = 0;
						for(let i =0; i< Positions.length -1; i++){
							console.log(Positions[i]);
							console.log(Positions[Positions.length-1]);
							if(Positions[i]==(Positions[Positions.length-1])){
								ThreefoldRpeptitionCounter += 1;
								if(ThreefoldRpeptitionCounter == 3){
									AmInCheck = 1;
									Kvadrati.forEach(item1 => {
										if(item.classList.contains('PURPLESQUARE')) item.classList.remove('PURPLESQUARE');
									});
									alert('Трикратно повторение на ходове - равенство!');
									break;
								}
							}
							console.log(ThreefoldRpeptitionCounter);

						}
						ThreefoldRpeptitionCounter = 0;
					}
				}
			}


			const LoadTakenFigures = () => {

				let WhiteBar = document.querySelector('.white-taken-figures');
				let BlackBar = document.querySelector('.black-taken-figures');

				[...WhiteBar.children].forEach(item => {
					item.remove();
				});
				[...BlackBar.children].forEach(item => {
					item.remove();
				});

				for(let i = 0; i < TakenFigures.length; i++){
					let img = document.createElement('img');
					img.src = PieceSet + '/Small' + TakenFigures[i].substring(0, 6) + '.png';

					if(TakenFigures[i].split('')[0]=='W'){
						WhiteBar.appendChild(img);
					} else{
						BlackBar.appendChild(img);
					}
				}
			}


			const LoadMoves = () => {
				let MoveListDiv = document.querySelector('.movelist');
				[...MoveListDiv.children].forEach(item => {
					item.remove();
				});
				for(let i = 0; i < moves.length; i++){
					if(i%2==0){
						let div1 = document.createElement('div');
						div1.classList.add('movelist-row');
						MoveListDiv.appendChild(div1);
					}
					let div2 = document.createElement('div');
					div2.classList.add('movelist-item');
					div2.innerText = moves[i];
					MoveListDiv.lastElementChild.appendChild(div2);
					MoveListDiv.lastElementChild.appendChild(div2);
				}
				//Увеличаваме височината на див-а ако не е достатъчно висок
				if([...MoveListDiv.children].length > 15 && !WhoseTurnIsIt){
					//Но само ако е черен на ход - иначе се увеличава твърде много
					MoveListDiv.parentNode.style.height = (parseInt(window.getComputedStyle(MoveListDiv.parentNode).height) + 30) + 'px';
				}
			}

			const Promotion = (DidITakeAFigure) => {
				let CurrentColor = '';
				let MovingFigure;
				let move1 = '';

				if(WhoseTurnIsIt){
					CurrentColor = 'White';
				}else{
					CurrentColor = 'Black';
				}
				let PromAlert = document.querySelector('.overlap');
				PromAlert.style.display = 'block';
				let PromotionSquares = document.querySelectorAll('.promotion-button');
				PromotionSquares.forEach(item => {
					item.style.background = '#B58863';
					if(item.classList.contains('promotion-Bishop')){
						item.style.backgroundImage= "url(" + PieceSet + '/' + CurrentColor + 'B.png)';
					}
					else if(item.classList.contains('promotion-Knight')){
						item.style.backgroundImage= "url(" + PieceSet + '/' + CurrentColor + 'K.png)';
					}
					else if(item.classList.contains('promotion-Rook')){
						item.style.backgroundImage= "url(" + PieceSet + '/' + CurrentColor + 'R.png)';
					}
					else if(item.classList.contains('promotion-Queen')){
						item.style.backgroundImage= "url(" + PieceSet + '/' + CurrentColor + 'Q.png)';
					}
					item.addEventListener('click', (e) => {
						//Натискаме бутон - promote
						CurrentlyPromoting = 0;
						if(item.classList.contains('promotion-Bishop')){
							MovingFigure = CurrentColor + 'Bishop';
						}
						else if(item.classList.contains('promotion-Knight')){
							MovingFigure = CurrentColor + 'Knight';
						}
						else if(item.classList.contains('promotion-Rook')){
							MovingFigure = CurrentColor + 'Rook';
						}
						else if(item.classList.contains('promotion-Queen')){
							MovingFigure = CurrentColor + 'Queen';
						}						
						board[MyCoordinates[0]][MyCoordinates[1]] = MovingFigure;
						if(TakenFigures.includes(MovingFigure)){
							for(let i =0; i<= TakenFigures.length; i++){
								if(TakenFigures[i] == MovingFigure){
									TakenFigures.splice(i,1);
								}
							}
						}
						VisualiseBoard();
						PromAlert.style.display = 'none';

						document.querySelector('#Tabl1').style.filter = 'brightness(100%)';
						WhoseTurnIsIt = !WhoseTurnIsIt;
						// В шах ли сме?
						if(WhoseTurnIsIt){
							if(CheckForDanger(indexOf2dArray(board, 'WhiteCar'), 'B') != 'safe'){
								AmInCheck = 1;
								CurrentDanger = CheckForDanger(indexOf2dArray(board, 'WhiteCar'), 'B');
								console.log('ШАХ!');
								if(CurrentDanger != 'двойна заплаха'){
									CurrentDanger.forEach(item => {
										document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(item[0])+1) + ') td:nth-child(' + (parseInt(item[1])+1) + ')').firstElementChild.classList.add('PURPLESQUARE');
									});									
								}
							}
							else{
								AmInCheck = 0;
								CurrentDanger = [];
								Kvadrati.forEach(item => {
									if(item.classList.contains('PURPLESQUARE')){
										item.classList.remove('PURPLESQUARE');
									}
								});
							}
						}else {
							if(CheckForDanger(indexOf2dArray(board, 'BlackCar'), 'W') != 'safe'){
								AmInCheck = 1;
								CurrentDanger = CheckForDanger(indexOf2dArray(board, 'BlackCar'), 'W');
								console.log('ШАХ!');
								if(CurrentDanger != 'двойна заплаха'){
									CurrentDanger.forEach(item => {
										document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(item[0])+1) + ') td:nth-child(' + (parseInt(item[1])+1) + ')').firstElementChild.classList.add('PURPLESQUARE');
									});									
								}
							}
							else{
								AmInCheck = 0;
								CurrentDanger = [];
								Kvadrati.forEach(item => {
									if(item.classList.contains('PURPLESQUARE')){
										item.classList.remove('PURPLESQUARE');
									}
								});
							}
						}

						//Визуализиране на направения ход
						//Ако "ходът" е празен - не е направена рокада
						let column;
						let column1;
							switch(OldCoordinates[1]){
									case 0:
										column1 = 'a';
										break;
									case 1:
										column1 = 'b';
										break;
									case 2:
										column1 = 'c';
										break;
									case 3:
										column1 = 'd';
										break;
									case 4:
										column1 = 'e';
										break;
									case 5:
										column1 = 'f';
										break;
									case 6:
										column1 = 'g';
										break;
									case 7:
										column1 = 'h';
										break;
								}


						switch(MyCoordinates[1]){
								case 0:
									column = 'a';
									break;
								case 1:
									column = 'b';
									break;
								case 2:
									column = 'c';
									break;
								case 3:
									column = 'd';
									break;
								case 4:
									column = 'e';
									break;
								case 5:
									column = 'f';
									break;
								case 6:
									column = 'g';
									break;
								case 7:
									column = 'h';
									break;
							}
							//Създаваме името на хода
							if(DidITakeAFigure){
								//Ако пешката е взела нещо, то се отбелязва реда и
								move1 += column1;								
								move1 += 'x';
								//Правилото с 50те хода се нулира при взета фигура	
								FiftyMoveRuleCounter = 0;
							} 
							move1 += column;
							move1 += (7 - parseInt(MyCoordinates[0]) + 1);
							//Показва се каква фигура е получена
							move1 += MovingFigure.split('')[5];
							if(AmInCheck){
								if(CheckForMate()) move1 += '#';
								else move1 += '+';
							}
						moves.push(move1);

						console.log(board);
						LoadMoves();
						VisualiseBoard();
						LoadTakenFigures();
						GetOpeningName();
						if(FiftyMoveRuleCounter == 100){
							//Заключваме дъската
							AmInCheck = 1;
							Kvadrati.forEach(item1 => {
								if(item.classList.contains('PURPLESQUARE')) item.classList.remove('PURPLESQUARE');
							});
							alert('Не сте местили пешка от 50 хода - равенство');
						}
						if(AmInCheck){
							if(CheckForMate()){
								let s;
								if(WhoseTurnIsIt){
									s = 'Белият'
								}
								else{
									s = 'Черният';
								}
								Kvadrati.forEach(item => {
										if(item.classList.contains('PURPLESQUARE')){
											item.classList.remove('PURPLESQUARE');
										}
									});
								alert(s + ' цар е в мат!');
							}
						}
						else{
							if(CheckForStalemate()){
								Kvadrati.forEach(item => {
									if(item.classList.contains('PURPLESQUARE')){
										item.classList.remove('PURPLESQUARE');
									}
								});						
								alert('Равенство - царят е в пат!');							
							}
						}
						Positions.push(GenerateFEN());
						console.log(Positions);


					});
				});
			}

			const CheckForStalemate = () => {
				let event = new Event('click');
				let ImStaleMated = 1;
				let CarCoordinates = [];
				for(let i = 0; i<8; i++){
					for(let j = 0; j < 8; j++){
						if(WhoseTurnIsIt && board[i][j].split('')[0] == 'W' && board[i][j].split('')[5] == 'C'){
							//Бял цар, има къде да мести
							CarCoordinates = [i, j];
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.dispatchEvent(event);
							Kvadrati.forEach(item => {
								if (item.classList.contains('GREENSQUARE')) ImStaleMated = 0;
							});
						}
						else if(!WhoseTurnIsIt && board[i][j].split('')[0] == 'B' && board[i][j].split('')[5] == 'C'){
							//Бял цар, има къде да мести
							CarCoordinates = [i, j];
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.dispatchEvent(event);
							Kvadrati.forEach(item => {
								if (item.classList.contains('GREENSQUARE')) ImStaleMated = 0;
							});							
						}
						else{
							//Фигура, която може да се мести
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.dispatchEvent(event);
							Kvadrati.forEach(item => {
								if (item.classList.contains('GREENSQUARE')) ImStaleMated = 0;

							});
						}
						RemGreenSquares();
					}
				}
				if(ImStaleMated){
					if(AmInCheck){
						document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(CarCoordinates[0])+1) + ') td:nth-child(' + (parseInt(CarCoordinates[1])+1) + ')').firstElementChild.classList.add('REDSQUARE');
					}
					return true;
				}
				else{
					return false;
				}

			}

			const CheckForMate = () => {
				let event = new Event('click');
				let ImMated = 1;
				let CarCoordinates = [];
				for(let i = 0; i<8; i++){
					for(let j = 0; j < 8; j++){
						if(WhoseTurnIsIt && board[i][j].split('')[0] == 'W' && board[i][j].split('')[5] == 'C'){
							//Бял цар, който може да избяга
							CarCoordinates = [i, j];
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.dispatchEvent(event);
							Kvadrati.forEach(item => {
								if (item.classList.contains('GREENSQUARE')) ImMated = 0;
							});
						}
						else if(!WhoseTurnIsIt && board[i][j].split('')[0] == 'B' && board[i][j].split('')[5] == 'C'){
							//Черен цар, който може да избяга
							CarCoordinates = [i, j];
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.dispatchEvent(event);
							Kvadrati.forEach(item => {
								if (item.classList.contains('GREENSQUARE')) ImMated = 0;
							});							
						}
						else{
							//Фигура, която може да блокира
							document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(i)+1) + ') td:nth-child(' + (parseInt(j)+1) + ')').firstElementChild.dispatchEvent(event);
							Kvadrati.forEach(item => {
								if (item.classList.contains('GREENSQUARE') && item.classList.contains('PURPLESQUARE') ) ImMated = 0;

							});
						}
						RemGreenSquares();
					}
				}
				RemGreenSquares();
				if(ImMated){
					if(AmInCheck){
						document.querySelector('#Tabl1 tr:nth-child(' + (parseInt(CarCoordinates[0])+1) + ') td:nth-child(' + (parseInt(CarCoordinates[1])+1) + ')').firstElementChild.classList.add('REDSQUARE');
					}
					return true;
				}
				else{
					return false;
				}
			}

			const CheckForDanger = (target, BorW) => {
				let red = parseInt(target[0]);
				let kol = parseInt(target[1]);
				let danger = [];
				let TempDanger = [];
				let dangercounter = 0;
				let oppositeOfBorW;

				if(BorW == 'B'){
					oppositeOfBorW = 'W';
				}
				else if (BorW == 'W'){
					oppositeOfBorW = 'B';
				} else{
					return('грешка');
				}

				//Пешки
				if(red >=1 && kol >=1 && board[red-1][kol-1].split('')[0] == BorW && board[red-1][kol-1].split('')[5]=='P' && BorW == 'B'){
					let i = [red-1, kol-1];
					danger.push(i);
					dangercounter +=1;
				}
				if(red >=1 && kol <=6 && board[red-1][kol+1].split('')[0] == BorW && board[red-1][kol+1].split('')[5]=='P' && BorW == 'B'){
					let i = [red-1, kol+1];
					danger.push(i);
					dangercounter +=1;
				}
				if(red <=6 && kol >=1 && board[red+1][kol-1].split('')[0] == BorW && board[red+1][kol-1].split('')[5]=='P' && BorW == 'W'){
					let i = [red+1, kol-1];
					danger.push(i);
					dangercounter +=1;
				}
				if(red <=6 && kol <=6 && board[red+1][kol+1].split('')[0] == BorW && board[red+1][kol+1].split('')[5]=='P' && BorW == 'W'){
					let i = [red+1, kol+1];
					danger.push(i);
					dangercounter +=1;
				}


				//Офицери
				//долен десен диагонал
				for(let i = 1; i <= 7;i++){
					if((parseInt(red)+parseInt(i)) >= 8 || (parseInt(kol)+parseInt(i)) >=8){
						TempDanger = [];
						break;
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)] == ''){
						//Празно поле	
						let j = [red+parseInt(i), kol+parseInt(i)];
						TempDanger.push(j);
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == BorW && board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[5] == 'B'){
						//Вражеска вигура
						let j = [red+parseInt(i), kol+parseInt(i)];
						TempDanger.push(j);						
						dangercounter +=1;
						break;		
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == BorW && board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[5] == 'Q'){
						//Вражеска вигура
						let j = [red+parseInt(i), kol+parseInt(i)];
						TempDanger.push(j);						
						dangercounter +=1;
						break;		
					}
					else{
						TempDanger = [];
						break;		
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];

				//долен ляв диагонал
				for(let i = 1; i <= 7;i++){
					if((parseInt(red)+parseInt(i)) >= 8 || (parseInt(kol)-parseInt(i)) < 0){
						TempDanger = [];
						break;
						//Overflow извън дъската
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)] == ''){
						//Празно поле					
						let j = [red+parseInt(i), kol-parseInt(i)];
						TempDanger.push(j);
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == BorW && board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[5] == 'B'){
						//Вражеска вигура
						let j = [red+parseInt(i), kol-parseInt(i)];
						TempDanger.push(j);
						dangercounter +=1;
						break;		
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == BorW && board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[5] == 'Q'){
						//Вражеска вигура
						let j = [red+parseInt(i), kol-parseInt(i)];
						TempDanger.push(j);
						dangercounter +=1;
						break;		
					}
					else{
						TempDanger = [];
						break;		
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];

				//горен десен диагонал
				for(let i = 1; i <= 7;i++){
					if((parseInt(red)-parseInt(i)) < 0 || (parseInt(kol)+parseInt(i)) >=8){
						TempDanger = [];
						break;
						//Overflow извън дъската
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)] == ''){
						let j = [red-parseInt(i), kol+parseInt(i)];
						TempDanger.push(j);
						//Празно поле					
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == BorW && board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[5] == 'B'){
						let j = [red-parseInt(i), kol+parseInt(i)];
						TempDanger.push(j);
						dangercounter +=1;
						break;		
						//Вражеска вигура
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == BorW && board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[5] == 'Q'){
						let j = [red-parseInt(i), kol+parseInt(i)];
						TempDanger.push(j);
						dangercounter +=1;
						break;		
						//Вражеска вигура
					}
					else{
						TempDanger = [];
						break;		
						//Своя вигура
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];

				//горен ляв диагонал
				for(let i = 1; i <= 7;i++){
					if((parseInt(red)-parseInt(i)) < 0 || (parseInt(kol)-parseInt(i)) < 0){
						TempDanger = [];
						break;
						//Overflow извън дъската
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)] == ''){
						//Празно поле					
						let j = [red-parseInt(i), kol-parseInt(i)];
						TempDanger.push(j);
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == BorW && board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[5] == 'B'){
						//Вражеска вигура
						let j = [red-parseInt(i), kol-parseInt(i)];
						dangercounter +=1;
						TempDanger.push(j);
						break;		
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == BorW && board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[5] == 'Q'){
						//Вражеска вигура
						let j = [red-parseInt(i), kol-parseInt(i)];
						dangercounter +=1;
						TempDanger.push(j);
						break;		
					}
					else{
						TempDanger = [];
						break;		
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];

				//Топове
				//надолу
				for(let i = red+1; i<=7;i++){
					if (board[i][kol]==''){
						let j = [i, kol];
						TempDanger.push(j);
						if(i ==7){
							TempDanger = [];
						}
					}
					else if (board[i][kol].split('')[0] == BorW && board[i][kol].split('')[5] == 'R'){
						let j = [i, kol];
						dangercounter +=1;
						TempDanger.push(j);
						break;
					}
					else if (board[i][kol].split('')[0] == BorW && board[i][kol].split('')[5] == 'Q'){
						let j = [i, kol];
						dangercounter +=1;
						TempDanger.push(j);
						break;
					}
					else{
						TempDanger = [];
						break;
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];

				//нагоре
				for(let i = red-1; i>=0;i--){
					if (board[i][kol]==''){
						let j = [i, kol];
						TempDanger.push(j);
						if(i == 0){
							TempDanger = [];
						}
					}
					else if (board[i][kol].split('')[0] == BorW && board[i][kol].split('')[5] == 'R'){
						let j = [i, kol];
						dangercounter +=1;
						TempDanger.push(j);
						break;
					}
					else if (board[i][kol].split('')[0] == BorW && board[i][kol].split('')[5] == 'Q'){
						let j = [i, kol];
						dangercounter +=1;
						TempDanger.push(j);
						break;
					}
					else{
						TempDanger = [];
						break;
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];

				//наляво
				for(let i = kol-1; i>=0;i--){
					if (board[red][i]==''){
						let j = [red, i];
						TempDanger.push(j);
						if (i == 0){
							TempDanger = [];
						}
					}
					else if (board[red][i].split('')[0] == BorW && board[red][i].split('')[5] == 'R'){
						let j = [red, i];
						TempDanger.push(j);
						dangercounter +=1;
						break;
					}
					else if (board[red][i].split('')[0] == BorW && board[red][i].split('')[5] == 'Q'){
						let j = [red, i];
						TempDanger.push(j);
						dangercounter +=1;
						break;
					}
					else{
						TempDanger = [];
						break;
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];

				//надясно
				for(let i = kol+1; i <=7;i++){
					if (board[red][i]==''){
						let j = [red, i];
						TempDanger.push(j);
						if(i ==7){
							TempDanger = [];
						}
					}
					else if (board[red][i].split('')[0] == BorW && board[red][i].split('')[5] == 'R'){
						let j = [red, i];
						TempDanger.push(j);
						dangercounter +=1;
						break;
					}
					else if (board[red][i].split('')[0] == BorW && board[red][i].split('')[5] == 'Q'){
						let j = [red, i];
						TempDanger.push(j);
						dangercounter +=1;
						break;
					}
					else{
						TempDanger = [];
						break;
					}
				}

				danger = [...danger, ...TempDanger];
				TempDanger = [];


				//Коне
				if( red >= 2 && kol <= 6){
					if(board[red-2][kol+1].split('')[0] == BorW && board[red-2][kol+1].split('')[5] == 'K'){
						let j = [red-2,kol+1];
						danger.push(j);
						dangercounter +=1;
					}
				}
				if( red >= 1 && kol <= 5){
					if(board[red-1][kol+2].split('')[0] == BorW && board[red-1][kol+2].split('')[5] == 'K'){
						let j = [red-1,kol+2];
						danger.push(j);
						dangercounter +=1;
					}
				}
				if( red <=6 && kol <= 5){
					if(board[red+1][kol+2].split('')[0] == BorW && board[red+1][kol+2].split('')[5] == 'K'){
						let j = [red+1,kol+2];
						danger.push(j);
						dangercounter +=1;
					}
				}
				if( red <=5 && kol <= 6){
					if(board[red+2][kol+1].split('')[0] == BorW && board[red+2][kol+1].split('')[5] == 'K'){
						let j = [red+2,kol+1];
						danger.push(j);
						dangercounter +=1;
					}
				}
				if( red <=5 && kol >=1){
					if(board[red+2][kol-1].split('')[0] == BorW && board[red+2][kol-1].split('')[5] == 'K'){
						let j = [red+2,kol-1];
						dangercounter +=1;
						danger.push(j);
					}
				}
				if( red <=6 && kol >=2){
					if(board[red+1][kol-2].split('')[0] == BorW && board[red+1][kol-2].split('')[5] == 'K'){
						let j = [red+1,kol-2];
						dangercounter +=1;
						danger.push(j);
					}
				}
				if( red >=1 && kol >=2){
					if(board[red-1][kol-2].split('')[0] == BorW && board[red-1][kol-2].split('')[5] == 'K'){
						let j = [red-1,kol-2];
						danger.push(j);
						dangercounter +=1;
					}
				}
				if( red >=2 && kol >=1){
					if(board[red-2][kol-1].split('')[0] == BorW && board[red-2][kol-1].split('')[5] == 'K'){
						let j = [red-2,kol-1];
						danger.push(j);
						dangercounter +=1;
					}
				}


				//Царе
				for(let i = 0; i < 3; i ++){
					for(let j = 0; j < 3; j++){
						if( parseInt(red)-1+i >=0 && parseInt(red)-1+i <=7 && parseInt(kol)-1+j >=0 && parseInt(kol)-1+j <=7){
							if (board[parseInt(red)-1+i][parseInt(kol)-1+j].split('')[0] == BorW && board[parseInt(red)-1+i][parseInt(kol)-1+j].split('')[5] == 'C'){
								let k = [red-1+i, kol-1+j];
								danger.push(k);
								dangercounter += 1;
							}
							else if (board[parseInt(red)-1+i][parseInt(kol)-1+j].split('')[0] == BorW && board[parseInt(red)-1+i][parseInt(kol)-1+j].split('')[5] == 'C'){
								let k = [red-1+i, kol-1+j];
								danger.push(k);
								dangercounter += 1;
							}						
						}
					}
				}



				if(dangercounter >1){
					return 'двойна заплаха';
				}
				else if (dangercounter == 1){
					return danger;
				}
				else if (dangercounter == 0){
					return 'safe';
				}
			}


			const WhitePawnMovement = (target) => {
				let red = target[0];
				let kol = target[1];

				//Вземане вляво
				if(kol>0){
					if (board[red-1][kol-1].split('')[0] == 'B'){
						MakeSquareGreen(red-1, kol-1);
					}
					//Ан-пасан
					if(EnPassant[0] == red-1 && EnPassant[1] == kol-1){
						MakeSquareGreen(red-1, kol-1);
					}
				}
				//Вземане вдясно
				if(kol<7){
					if (board[red-1][kol+1].split('')[0] == 'B'){
						MakeSquareGreen(red-1, kol+1);
					}
					//Ан-пасан
					if(EnPassant[0] == red-1 && EnPassant[1] == kol+1){
						MakeSquareGreen(red-1, kol+1);
					}
				}
				//1 напред
				if(board[red-1][kol] == ''){
					MakeSquareGreen(red-1, kol);
				}
				//2 напред	
				if(red == '6' &&board[red-1][kol] == '' && board[red-2][kol] == ''){
					MakeSquareGreen(red-2, kol);
				}
			}

			const BlackPawnMovement = (target) => {
				let red = target[0];
				let kol = target[1];

				//Вземане вляво
				if(kol>0){
					if (board[red+1][kol-1].split('')[0] == 'W'){
						MakeSquareGreen(red+1, kol-1);
					}						
					//Ан-пасан
					if(EnPassant[0] == red+1 && EnPassant[1] == kol-1){
						MakeSquareGreen(red+1, kol-1);
					}
				}
				//Вземане вдясно
				if(target[1]<7){
					if (board[red+1][kol+1].split('')[0] == 'W'){
						MakeSquareGreen(red+1, kol+1);
						}
					//Ан-пасан
					if(EnPassant[0] == red+1 && EnPassant[1] == kol+1){
						MakeSquareGreen(red+1, kol+1);
					}
				}
				//1 напред
				if(board[red+1][kol] == ''){
						MakeSquareGreen(red+1, kol);
				}
				//2 напред	
				if(red == '1' && board[red+1][kol] == '' && board[red+2][kol] == ''){
						MakeSquareGreen(red+2, kol);
				}
			}
			const BishopMovement = (target) => {
				let red = parseInt(target[0]);
				let kol = parseInt(target[1]);

				//долен десен диагонал
				for(let i = 1; i <= 7;i++){
					if((red+i) >= 8 || (kol+i) >=8){
						break;
						//Overflow извън дъската
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)] == ''){
						//Празно поле					
						MakeSquareGreen(red+i, kol+i);						
					}
					else if(WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'B'){
						//Вражеска вигура
						MakeSquareGreen(red+i, kol+i);						
						break;		
					}
					else if(WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'W'){
						//Своя вигура
						break;		
					}						
					else if(!WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'W'){
						//Вражеска вигура
						MakeSquareGreen(red+i, kol+i);						
						break;			
					}	
					else if(!WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'B'){
						//Своя вигура
						break;			
					}
				}
				//долен ляв диагонал
				for(let i = 1; i <= 7;i++){
					if((parseInt(red)+parseInt(i)) >= 8 || (parseInt(kol)-parseInt(i)) < 0){
						break;
						//Overflow извън дъската
					}
					else if(board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)] == ''){
						//Празно поле					
						MakeSquareGreen(red+i, kol-i);						
					}
					else if(WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'B'){
						//Вражеска вигура
						MakeSquareGreen(red+i, kol-i);						
						break;		
					}
					else if(WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'W'){
						//Своя вигура
						break;		
					}
					else if(!WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'W'){
						//Вражеска вигура
						MakeSquareGreen(red+i, kol-i);						
						break;			
					}	
					else if(!WhoseTurnIsIt && board[parseInt(red)+parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'B'){
						//Своя вигура
					break;			
					}
				}
				//горен десен диагонал
				for(let i = 1; i <= 7;i++){
					if((parseInt(red)-parseInt(i)) < 0 || (parseInt(kol)+parseInt(i)) >=8){
						break;
						//Overflow извън дъската
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)] == ''){
						MakeSquareGreen(red-i, kol+i);	
						//Празно поле					
					}
					else if(WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'B'){
						MakeSquareGreen(red-i, kol+i);						
						break;		
						//Вражеска вигура
					}
					else if(WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'W'){
						break;		
						//Своя вигура
					}
					else if(!WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'W'){
						MakeSquareGreen(red-i, kol+i);						
						break;			
						//Вражеска вигура
					}
					else if(!WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)+parseInt(i)].split('')[0] == 'B'){
						break;			
						//Своя вигура
					}	
				}

				//горен ляв диагонал
				for(let i = 1; i <= 7;i++){
					if((parseInt(red)-parseInt(i)) < 0 || (parseInt(kol)-parseInt(i)) < 0){
						break;
						//Overflow извън дъската
					}
					else if(board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)] == ''){
						//Празно поле					
						MakeSquareGreen(red-i, kol-i);						
					}
					else if(WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'B'){
						//Вражеска вигура
						MakeSquareGreen(red-i, kol-i);						
						break;		
					}
					else if(WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'W'){
						//Своя вигура
						break;		
					}
					else if(!WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'W'){
						//Вражеска вигура
						MakeSquareGreen(red-i, kol-i);						
						break;			
					}
					else if(!WhoseTurnIsIt && board[parseInt(red)-parseInt(i)][parseInt(kol)-parseInt(i)].split('')[0] == 'B'){
						//Своя вигура
						break;			
					}							
				}
			}

			const RookMovement = (target) => {
				let red = target[0];
				let kol = target[1];

				//надолу
				for(let i = red+1; i<=7;i++){
					if (board[i][kol]==''){
						MakeSquareGreen(i,kol);
					}
					else if (WhoseTurnIsIt && board[i][kol].split('')[0] == 'B'){
						MakeSquareGreen(i,kol);
						break;
					}
					else if (WhoseTurnIsIt && board[i][kol].split('')[0] == 'W'){
						break;
					}
					else if (!WhoseTurnIsIt && board[i][kol].split('')[0] == 'W'){
						MakeSquareGreen(i,kol);
						break;
					}
					else if (!WhoseTurnIsIt && board[i][kol].split('')[0] == 'B'){
						break;
					}
				}
				//нагоре
				for(let i = red-1; i>=0;i--){
					if (board[i][kol]==''){
						MakeSquareGreen(i,kol);
					}
					else if (WhoseTurnIsIt && board[i][kol].split('')[0] == 'B'){
						MakeSquareGreen(i,kol);
						break;
					}
					else if (WhoseTurnIsIt && board[i][kol].split('')[0] == 'W'){
						break;
					}
					else if (!WhoseTurnIsIt && board[i][kol].split('')[0] == 'W'){
						MakeSquareGreen(i,kol);
						break;
					}
					else if (!WhoseTurnIsIt && board[i][kol].split('')[0] == 'B'){
						break;
					}
				}
				//наляво
				for(let i = kol-1; i>=0;i--){
					if (board[red][i]==''){
						MakeSquareGreen(red, i);
					}
					else if (WhoseTurnIsIt && board[red][i].split('')[0] == 'B'){
						MakeSquareGreen(red, i);
						break;
					}
					else if (WhoseTurnIsIt && board[red][i].split('')[0] == 'W'){
						break;
					}
					else if (!WhoseTurnIsIt && board[red][i].split('')[0] == 'W'){
						MakeSquareGreen(red, i);
						break;
					}
					else if (!WhoseTurnIsIt && board[red][i].split('')[0] == 'B'){
						break;
					}
				}
				//надясно
				for(let i = kol+1; i <=7;i++){
					if (board[red][i]==''){
						MakeSquareGreen(red, i);
					}
					else if (WhoseTurnIsIt && board[red][i].split('')[0] == 'B'){
						MakeSquareGreen(red, i);
						break;
					}
					else if (WhoseTurnIsIt && board[red][i].split('')[0] == 'W'){
						break;
					}
					else if (!WhoseTurnIsIt && board[red][i].split('')[0] == 'W'){
						MakeSquareGreen(red, i);
						break;
					}
					else if (!WhoseTurnIsIt && board[red][i].split('')[0] == 'B'){
						break;
					}
				}
			}

			const KnightMovement = (target) => {
				let red = target[0];
				let kol = target[1];

				//Ако полето не е out of scope проверяваме дали е празно или вражеска фигура

				if( red >= 2 && kol <= 6){
					if(board[red-2][kol+1]=='' ){
						MakeSquareGreen(red-2, kol+1);
					}
					else if(!WhoseTurnIsIt && board[red-2][kol+1].split('')[0] == 'W' ){
						MakeSquareGreen(red-2, kol+1);
					}
					else if(WhoseTurnIsIt && board[red-2][kol+1].split('')[0] == 'B' ){
						MakeSquareGreen(red-2, kol+1);
					}
				}
				if( red >= 1 && kol <= 5){
					if(board[red-1][kol+2]=='' ){
						MakeSquareGreen(red-1, kol+2);
					}
					else if(!WhoseTurnIsIt && board[red-1][kol+2].split('')[0] == 'W' ){
						MakeSquareGreen(red-1, kol+2);
					}
					else if(WhoseTurnIsIt && board[red-1][kol+2].split('')[0] == 'B' ){
						MakeSquareGreen(red-1, kol+2);
					}
				}
				if( red <=6 && kol <= 5){
					if(board[red+1][kol+2]=='' ){
						MakeSquareGreen(red+1, kol+2);
					}
					else if(!WhoseTurnIsIt && board[red+1][kol+2].split('')[0] == 'W' ){
						MakeSquareGreen(red+1, kol+2);
					}
					else if(WhoseTurnIsIt && board[red+1][kol+2].split('')[0] == 'B' ){
						MakeSquareGreen(red+1, kol+2);
					}
				}
				if( red <=5 && kol <= 6){
					if(board[red+2][kol+1]=='' ){
						MakeSquareGreen(red+2, kol+1);
					}
					else if(!WhoseTurnIsIt && board[red+2][kol+1].split('')[0] == 'W' ){
						MakeSquareGreen(red+2, kol+1);
					}
					else if(WhoseTurnIsIt && board[red+2][kol+1].split('')[0] == 'B' ){
						MakeSquareGreen(red+2, kol+1);
					}
				}
				if( red <=5 && kol >=1){
					if(board[red+2][kol-1]=='' ){
						MakeSquareGreen(red+2, kol-1);
					}
					else if(!WhoseTurnIsIt && board[red+2][kol-1].split('')[0] == 'W' ){
						MakeSquareGreen(red+2, kol-1);
					}
					else if(WhoseTurnIsIt && board[red+2][kol-1].split('')[0] == 'B' ){
						MakeSquareGreen(red+2, kol-1);
					}
				}
				if( red <=6 && kol >=2){
					if(board[red+1][kol-2]=='' ){
						MakeSquareGreen(red+1, kol-2);
					}
					else if(!WhoseTurnIsIt && board[red+1][kol-2].split('')[0] == 'W' ){
						MakeSquareGreen(red+1, kol-2);
					}
					else if(WhoseTurnIsIt && board[red+1][kol-2].split('')[0] == 'B' ){
						MakeSquareGreen(red+1, kol-2);
					}
				}
				if( red >=1 && kol >=2){
					if(board[red-1][kol-2]=='' ){
						MakeSquareGreen(red-1, kol-2);
					}
					else if(!WhoseTurnIsIt && board[red-1][kol-2].split('')[0] == 'W' ){
						MakeSquareGreen(red-1, kol-2);
					}
					else if(WhoseTurnIsIt && board[red-1][kol-2].split('')[0] == 'B' ){
						MakeSquareGreen(red-1, kol-2);
					}
				}
				if( red >=2 && kol >=1){
					if(board[red-2][kol-1]=='' ){
						MakeSquareGreen(red-2, kol-1);
					}
					else if(!WhoseTurnIsIt && board[red-2][kol-1].split('')[0] == 'W' ){
						MakeSquareGreen(red-2, kol-1);
					}
					else if(WhoseTurnIsIt && board[red-2][kol-1].split('')[0] == 'B' ){
						MakeSquareGreen(red-2, kol-1);
					}
				}
			}

			const KingMovement = (target) => {
				let red = parseInt(target[0]);
				let kol = parseInt(target[1]);
				if(WhoseTurnIsIt){
					check = 'W';
					opposite = 'B';
				}else {
					check = 'B';
					opposite = 'W';
				}


				//За да проверим къде може да се движи царя, трябва да го махнем от дъската - не можем да се движим по заплашен диагонал, и да се "скрием" зад себе си
				let currentfigure = board[red][kol];
				board[red][kol] = '';
				
				for(let i = 0; i < 3; i ++){
					for(let j = 0; j < 3; j++){
						if( red-1+i >=0 && red-1+i <=7 && kol-1+j >=0 && kol-1+j <=7){
							if (board[red-1+i][kol-1+j].split('')[0] == check){
								//Своя фигура - не можем да местим тук
							}
							else if (CheckForDanger([red-1+i, kol-1+j], opposite) == 'safe'){
								//Безопасно поле - царя може да се премести там
								if(i==1 && j==1){
									//Полето на което е царя не трябва да се оцвети
								}else{
									MakeSquareGreen(red-1+i, kol-1+j);
								}
							}			
						}
					}
				}

				board[red][kol] = currentfigure;


				//Рокади
				if(WhoseTurnIsIt && WhiteCastleShort && CheckForDanger([7, 5],opposite) == 'safe' && CheckForDanger([7, 6],opposite) == 'safe' && board[7][5] == '' && board[7][6] == ''){
					MakeSquareGreen(7, 6);
				}
				if(WhoseTurnIsIt && WhiteCastleLong && CheckForDanger([7, 4],opposite) == 'safe' && CheckForDanger([7, 3],opposite) == 'safe' && board[7][1] == '' && board[7][2] == '' && board[7][3] == ''){
					MakeSquareGreen(7, 2);
				}
				if(!WhoseTurnIsIt && BlackCastleShort && CheckForDanger([0, 5],opposite) == 'safe' && CheckForDanger([0, 6],opposite) == 'safe' && board[0][5] == '' && board[0][6] == ''){
					MakeSquareGreen(0, 6);
				}
				if(!WhoseTurnIsIt && BlackCastleLong && CheckForDanger([0, 4],opposite) == 'safe' && CheckForDanger([0, 3],opposite) == 'safe' && board[0][1] == '' && board[0][2] == '' && board[0][3] == ''){
					MakeSquareGreen(0, 2);
				}
			}
		});
	</script>
	<style>
		body{
			margin: 0px;
			background: #f2e9da;
			font-family: Arial, Helvetica, sans-serif;
		}
		table{
			border-spacing: 0px;
			border: 5px solid black;
		}
		button{
			border-spacing: 0px;
			box-sizing: border-box;			
		}
		td{
			padding: 0px;
			margin: 0px;
			height: 80px;
			width: 80px;
		}
		tr{
			padding: 0px;
			margin: 0px;
			height: 80px;
			font-size: 0px;	
		}
		.board-square{
			height: 80px;
			width: 80px;
			margin: 0px;
			padding: 0px;
			border: none;
		}
		.GREENSQUARE{
		}
		.PURPLESQUARE{
		}
		.REDSQUARE{
		}
		.movelist-row{
			display: flex;
			margin-bottom: 7px;
		}
		.movelist-item{
			width: 70px;
			text-align: center;
			font-size: 20px;

		}
		.white-taken-figures{
			height: 40px;
		}
		.black-taken-figures{
			height: 40px;
		}
		.overlap{
			position: absolute;
			z-index: 2;
			margin-top: 290px;
			height: 160px;
			width: 600px;
			margin-left: 15px;
			background: #F0D9B5;
			border: solid 5px #664229; 
			display: none;
		}
		.promotion-title{
			font-size: 30px;
			text-align: center;
			font-family: Arial, Helvetica, sans-serif;
			margin-top: 2px;
		}
		.promotion-text{
			font-size: 25px;
			text-align: center;
			font-family: Arial, Helvetica, sans-serif;
			margin-top: 5px;			
		}
		.button-row{
			display: flex;
			justify-content: space-between;
			margin-left: 50px;
			margin-right: 50px;
		}
		.promotion-button{
			height: 80px;
			margin-top: 5px;
			margin-bottom: 2px;
			width: 80px;
			padding: 0px;
			border: none;
		}
		#Tabl1{
			margin-top: 10px;
			margin-bottom: 10px;
		}
		.timer-button{
			display: none;
			border: none;
			width: 90px;
			font-size: 15px;
			margin-top: 20px;
			margin-bottom: 20px;
		}
		.container{
			margin: 0 auto;
			width: 1200px;
		}
		.fieldset-div{
			width: 150px;
			margin-top: 75px;
		}
		.reset{
			margin-top: 20px;
			margin-bottom: 20px;
			height:50px;
			width:150px;
			background: #82c9f4;
			border: none;
			font-family: Arial, Helvetica, sans-serif;
			font-size: 20px;
			text-align: center;
		}
		.timer-box{
			margin-top: 50px;	
			width: 90px;		
		}
		.white-10-min, .white-5-min, .white-3-min, .white-plus-1-min, .white-timer{

			font-size: 14px;
			color: black;
			border: solid 5px black;
			background: white;
			text-align: center;
			font-family: Arial, Helvetica, sans-serif;
		}
		.black-10-min, .black-5-min, .black-3-min, .black-plus-1-min, .black-timer{
			font-size: 14px;
			color: white;
			border: solid 5px white;
			background: black;
			text-align: center;
			font-family: Arial, Helvetica, sans-serif;
		}
		.white-timer, .black-timer{
			font-size: 20px;
		}
		.opening{
			width:150px;
			text-align: center;
			font-size: 20px;
			margin-bottom: 20px;
			height: 75px;
		}
		.opening-text{
			width:150px;
			text-align: center;
			font-size: 15px;
			margin-top: 15px;
			margin-bottom: 15px;
		}
		.box{
			border: solid 3px black;
			border-radius: 10px;
			height: 600px;
		}

	</style>

</head>
<body>
	<div>
		<div class="container">
			<div class="button-row">
				<div>
					<div class="overlap" >
						<div class="promotion-title">Пешката ви достигна до последния ред!</div>
						<div class="promotion-text">Каква фигура искате да получите?</div>
						<div class="button-row">
							<button class="promotion-button promotion-Queen"></button>
							<button class="promotion-button promotion-Rook"></button>
							<button class="promotion-button promotion-Knight"></button>
							<button class="promotion-button promotion-Bishop"></button>
						</div>
					</div>
					<div class="white-taken-figures"></div>
					<table cellspacing="0" cellpadding="0" cellmargin="0" id="Tabl1">
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
						<tr>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
							<td><div class="board-square"></div></td>
						</tr>
					</table>
					<div class="black-taken-figures"></div>
				</div>
				<div>
					<button class="reset">Нова игра</button>
					<div class="box">
						<div class="opening-text">Вие играете:</div>
						<div class="opening" id="OpeningNameDiv">Начална позиция</div>
						<div class="movelist">
							<div></div>
						</div>					
					</div>
				</div>
				<div>
					<div class="timer-box">
						<div class="black-timer">10:00</div>
						<div class="white-timer">10:00</div>
						<input type="checkbox" id="TimerCheckbox" name="timercheckbox" class="timercheckbox">
						<label for="timercheckbox">Таймери</label>
						<button data-color="white" data-time="=6000" class="timer-button white-10-min">10 минути</button>
						<button data-color="black" data-time="=6000" class="timer-button black-10-min">10 минути</button>
						<button data-color="white" data-time="=3000" class="timer-button white-5-min">5 минути</button>
						<button data-color="black" data-time="=3000" class="timer-button black-5-min">5 минути</button>
						<button data-color="white" data-time="=1800" class="timer-button white-3-min">3 минути</button>
						<button data-color="black" data-time="=1800" class="timer-button black-3-min">3 минути</button>
						<button data-color="white" data-time="+600" class="timer-button white-plus-1-min">+1 минута</button>
						<button data-color="black" data-time="+600" class="timer-button black-plus-1-min">+1 минута</button>			
					</div>
				</div>
				<div class="fieldset-div">
					<fieldset>
						<legend>Тип на дъска</legend>
						<div>
							<input type="radio" name="board" id="brown" checked class="board-radio board-brown">
							<label for="brown">Кафява</label>
						</div>
						<div>
							<input type="radio" name="board" id="grey" class="board-radio board-grey">
							<label for="grey">Сива</label>
						</div>
						<div>
							<input type="radio" name="board" id="red" class="board-radio board-red">
							<label for="red">Червена</label>
						</div>
					</fieldset>

					<fieldset>
						<legend>Тип на фигури</legend>
						<div>
							<input type="radio" name="pieces" id="Type-1" checked class="pieces-radio piece-type-1">
							<label for="Type-1">Тип 1</label>
						</div>
						<div>
							<input type="radio" name="pieces" id="Type-2" class="pieces-radio piece-type-2">
							<label for="Type-2">Тип 2</label>
						</div>
						<div>
							<input type="radio" name="pieces" id="Type-3" class="pieces-radio piece-type-3">
							<label for="Type-3">Тип 3</label>
						</div>
					</fieldset>
				</div>
			</div>
		</div>
	</div>
</body>
</html>